# Introduction

The control unit plays a vital role in a digital computer by initiating sequences of microoperations. There are two primary methods to implement the control unit: Hardwired Control and Microprogrammed Control.

## Hardwired Control

### Characteristics:
- **Generation of Control Signals:**
  - Control signals are generated by hardware using conventional logic design techniques.

- **Key Characteristics:**
  - High speed of operation.
  - Expensive.
  - Relatively complex.
  - Lacks flexibility for adding new instructions.

- **Examples:**
  - CPUs with hardwired control units include Intel 8085, Motorola 6802, Zilog 80, and various RISC CPUs.

## Microprogrammed Control

### Characteristics:
- **Control Information Storage:**
  - Control information is stored in control memory.

- **Operation Initiation:**
  - Control memory is programmed to initiate the required sequence of micro-operations.

- **Key Characteristics:**
  - Speed of operation is comparatively lower than hardwired.
  - Less complex.
  - Less expensive.
  - Provides flexibility to add new instructions.

- **Examples:**
  - CPUs with microprogrammed control units include Intel 8080, Motorola 68000, and various CISC CPUs.

# Control Memory

Control Memory plays a crucial role in Microprogrammed Control Units, enabling the execution of microoperations based on control variables.
![[Pasted image 20231120201351.png]]
## Key Concepts:

1. **Control Variables:**
   - The control function specifying a microoperation is termed as the control variable.
   - When the control variable is in one binary state, the corresponding microoperation is executed.
   - In the other binary state, the state of registers remains unchanged.

2. **Active State of Control Variables:**
   - The active state of a control variable may be either 1 or 0, depending on the application.

3. **Control Signals in Bus-Organized Systems:**
   - For bus-organized systems, control signals are groups of bits selecting paths in multiplexers, decoders, and arithmetic logic units.

4. **Control Word:**
   - The control variables at any given time can be represented by a string of 1s and 0s, known as a control word.
   - Control words can be programmed for various system operations.

5. **Microprogram Control Unit:**
   - A control unit with binary control variables stored in memory is termed a microprogram control unit.
   - The control word in control memory contains a microinstruction specifying one or more micro-operations.
   - A sequence of microinstructions constitutes a microprogram.

6. **Control Memory Organization:**
   - Control memory is a permanent, read-only memory (ROM).
   - The microprogrammed control unit's general configuration is depicted in the block diagram.

7. **Next Address Generator (Microprogram Sequencer):**
   - Responsible for generating the next microinstruction address.
   - May depend on present microinstruction bits or external input conditions.

8. **Control Data Register (CDR):**
   - Holds the microinstruction read from memory.
   - Sometimes referred to as a pipeline register.

9. **Microprogrammed Control Unit in a Computer:**
   - A computer with a microprogrammed control unit has two separate memories: main memory and control memory.
   - The microprogram consists of microinstructions specifying internal control signals for various register microoperations.

10. **Microinstructions Execution:**
    - Microinstructions in the microprogram perform operations such as fetching instructions from main memory, evaluating effective addresses, executing operations, and transitioning to the fetch phase for the next instruction.

# Address Sequencing

- Microinstructions are stored in control memory in groups, with each group specifying a routine.
- Each computer instruction has its own microprogram routine to generate the microoperations.
- The hardware that controls the address sequencing of the control memory must be capable of sequencing the microinstructions within a routine and be able to branch from one routine to another.
- Steps the control must undergo during the execution of a single computer instruction:
  - Load an initial address into the CAR when power is turned on in the computer. This address is usually the address of the first microinstruction that activates the instruction fetch routine – IR holds instruction.
  - The control memory then goes through the routine to determine the effective address of the operand – AR holds operand address.
  - The next step is to generate the microoperations that execute the instruction by considering the opcode and applying a mapping process.
    - The transformation of the instruction code bits to an address in control memory where the routine of instruction located is referred to as the mapping process.
  - After execution, control must return to the fetch routine by executing an unconditional branch.

In brief, the address sequencing capabilities required in control memory are:
- Incrementing of the control address register.
- Unconditional branch or conditional branch, depending on status bit conditions.
- A mapping process from the bits of the instruction to an address for control memory.
- A facility for subroutine call and return.

The below figure shows a block diagram of a control memory and the associated hardware needed for selecting the next microinstruction address.

![[Pasted image 20231122221758.png]]

- The microinstruction in control memory contains a set of bits to initiate microoperations in computer registers and other bits to specify the method by which the next address is obtained.

- In the figure, four different paths form which the control address register (CAR) receives the address:
  1. The incrementer increments the content of the control register address register by one, to select the next microinstruction in sequence.
  2. Branching is achieved by specifying the branch address in one of the fields of the microinstruction.
  3. Conditional branching is obtained by using part of the microinstruction to select a specific status bit in order to determine its condition.
  4. An external address is transferred into control memory via a mapping logic circuit.

- The return address for a subroutine is stored in a special register; that value is used when the microprogram wishes to return from the subroutine.

# Microprogram Example

- The process of code generation for the control memory is called microprogramming.

- The block diagram of the computer configuration is shown in the figure below.

- Two memory units:
  - Main memory – stores instructions and data
  - Control memory – stores microprogram

- Four processor registers:
  - Program counter – PC
  - Address register – AR
  - Data register – DR
  - Accumulator register - AC

- Two control unit registers:
  - Control address register – CAR
  - Subroutine register – SBR

- Transfer of information among registers in the processor is through MUXs rather than a bus.
![[Pasted image 20231120201710.png]]

- The computer instruction format is shown in the figure below.
![[Pasted image 20231120201729.png]]
  - Three fields for an instruction:
    - 1-bit field for indirect addressing
    - 4-bit opcode
    - 11-bit address field

- The example will only consider the following 4 of the possible 16 memory instructions.
![[Pasted image 20231122222319.png]]
- The microinstruction format for the control memory is shown in the figure below.
![[Pasted image 20231122222333.png]]
  - The microinstruction format is composed of 20 bits with four parts to it:
    - Three fields F1, F2, and F3 specify microoperations for the computer [3 bits each]
    - The CD field selects status bit conditions [2 bits]
    - The BR field specifies the type of branch to be used [2 bits]
    - The AD field contains a branch address [7 bits]

- Each of the three microoperation fields can specify one of seven possibilities.
- No more than three microoperations can be chosen for a microinstruction.
- If fewer than three are needed, the code 000 = NOP.
- The three bits in each field are encoded to specify seven distinct microoperations listed in the table below.

![[Pasted image 20231122222420.png]]

- The condition field (CD) is two bits to specify four status bit conditions shown below.
![[Pasted image 20231122222431.png]]
- The branch field (BR) consists of two bits and is used with the address field to choose the address of the next microinstruction.
![[Pasted image 20231122222441.png]]
- Each line of an assembly language microprogram defines a symbolic microinstruction and is divided into five parts:
  1. The label field may be empty or it may specify a symbolic address. Terminate with a colon (: ).
  2. The microoperations field consists of 1-3 symbols, separated by commas. Only one symbol from each field. If NOP, then translated to 9 zeros.
  3. The condition field specifies one of the four conditions.
  4. The branch field has one of the four branch symbols.
  5. The address field has three formats:
     - A symbolic address – must also be a label
     - The symbol NEXT to designate the next address in sequence
     - Empty if the branch field is RET or MAP and is converted to 7 zeros.

- The symbol ORG defines the first address of a microprogram routine.
- ORG 64 – places the first microinstruction at control memory 1000000.


# The Design of Control Unit

## Design of Control Unit

- The control memory, out of each subfield, must be decoded to provide distinct microoperations.

- The outputs of the decoders are connected to the appropriate inputs in the processor unit.

- The figure below shows three decoders and some of the connections that must be made from their outputs.
![[Pasted image 20231122223401.png]]
- The three fields of the microinstruction in the output of the control memory are decoded with a 3x8 decoder to provide eight outputs.

- Each output must be connected to the proper circuit to initiate the corresponding microoperation as specified in the previous topic.

- When F1 = 101 (binary 5), the next pulse transition transfers the content of DR (0-10) to AR.

- Similarly, when F1 = 110 (binary 6), there is a transfer from PC to AR (symbolized by PCTAR). Outputs 5 and 6 of decoder F1 are connected to the load input of AR so that when either one of these outputs is active, information from the multiplexers is transferred to AR.

- The multiplexers select information from DR when output 5 is active and from PC when output 5 is inactive.

- The transfer into AR occurs with a clock transition only when output 5 or output 6 of the decoder is active.

- For the arithmetic logic shift unit, the control signals are instead of coming from the logical gates; now, these inputs will come from the outputs of AND, ADD, and DRTAC, respectively.

## Microprogram Sequencer

- The basic components of a microprogrammed control unit are the control memory and the circuits that select the next address.

- The address selection part is called a microprogram sequencer.

- The purpose of a microprogram sequencer is to present an address to the control memory so that a microinstruction may be read and executed.

- The next-address logic of the sequencer determines the specific address source to be loaded into the control address register.

- The block diagram of the microprogram sequencer is shown in the figure below.

- There are two multiplexers in the circuit.
  - The first multiplexer selects an address from one of four sources and routes it into the control address register (CAR).
  - The second multiplexer tests the value of a selected status bit, and the result of the test is applied to an input logic circuit.

- The output from CAR provides the address for the control memory.

- The content of CAR is incremented and applied to one of the multiplexer inputs and to the subroutine register (SBR).

- The other three inputs to the multiplexer come from:
  - The address field of the present microinstruction
  - From the output of SBR
  - From an external source that maps the instruction

- The CD (condition) field of the microinstruction selects one of the status bits in the second multiplexer.

- If the bit selected is equal to 1, the T variable is equal to 1; otherwise, it is equal to 0.

- The T value, together with two bits from the BR (branch) field, goes to an input logic circuit.

- The input logic in a particular sequencer will determine the type of operations that are available in the unit.

- The input logic circuit in the figure above has three inputs I0, I1, and T, and three outputs, S0, S1, and L.

- Variables S0 and S1 select one of the source addresses for CAR. Variable L enables the load input in SBR.

- The binary values of the selection variables determine the path in the multiplexer.

- For example, with S1, S0 = 10, multiplexer input number 2 is selected and establishes a transfer path from SBR to CAR.

- The truth table for the input logic circuit is shown in the table below.

- Inputs I1 and I0 are identical to the bit values in the BR field.

- The bit values for S1 and S0 are determined from the stated function and the path in the multiplexer that establishes the required transfer.

- The subroutine register is loaded with the incremented value of CAR during a call microinstruction (BR = 01) provided that the status bit condition is satisfied (T = 1).

- The truth table can be used to obtain the simplified Boolean functions for the input logic circuit:
  - S1 = I1
  - S0 = I1I0 + I'1T
  - L = I'1T
